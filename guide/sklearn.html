
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Bag of, not words, but tricks!">
      
      
      
        <meta name="author" content="Vincent D. Warmerdam">
      
      
        <link rel="canonical" href="https://koaning.github.io/tokenwiser/guide/sklearn.html">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>Scikit-Learn - tokenwiser</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CUbuntu+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Ubuntu";--md-code-font-family:"Ubuntu Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../style.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="teal">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#text-preparation-tools" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="tokenwiser" class="md-header__button md-logo" aria-label="tokenwiser" data-md-component="logo">
      
  <img src="../token.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            tokenwiser
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Scikit-Learn
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/koaning/tokenwiser/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../index.html" class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="sklearn.html" class="md-tabs__link md-tabs__link--active">
      Scikit-Learn
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="spacy.html" class="md-tabs__link">
      spaCy
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../api/textprep.html" class="md-tabs__link">
        API
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../faq.html" class="md-tabs__link">
      FAQ
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="tokenwiser" class="md-nav__button md-logo" aria-label="tokenwiser" data-md-component="logo">
      
  <img src="../token.png" alt="logo">

    </a>
    tokenwiser
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/koaning/tokenwiser/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Scikit-Learn
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="sklearn.html" class="md-nav__link md-nav__link--active">
        Scikit-Learn
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#text-preparation-tools" class="md-nav__link">
    Text Preparation Tools
  </a>
  
    <nav class="md-nav" aria-label="Text Preparation Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-pipeline" class="md-nav__link">
    Base Pipeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spelling-errors" class="md-nav__link">
    Spelling Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#long-texts" class="md-nav__link">
    Long Texts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bag-of-tricks" class="md-nav__link">
    Bag of Tricks!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-tools" class="md-nav__link">
    Pipeline Tools
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#concatenate-text" class="md-nav__link">
    Concatenate Text
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#partial-fit" class="md-nav__link">
    Partial Fit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concatenate-features" class="md-nav__link">
    Concatenate Features
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="spacy.html" class="md-nav__link">
        spaCy
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/textprep.html" class="md-nav__link">
        textprep
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipeline.html" class="md-nav__link">
        pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/extension.html" class="md-nav__link">
        extension
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/component.html" class="md-nav__link">
        component
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/wabbit.html" class="md-nav__link">
        wabbit
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../faq.html" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#text-preparation-tools" class="md-nav__link">
    Text Preparation Tools
  </a>
  
    <nav class="md-nav" aria-label="Text Preparation Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-pipeline" class="md-nav__link">
    Base Pipeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spelling-errors" class="md-nav__link">
    Spelling Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#long-texts" class="md-nav__link">
    Long Texts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bag-of-tricks" class="md-nav__link">
    Bag of Tricks!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-tools" class="md-nav__link">
    Pipeline Tools
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#concatenate-text" class="md-nav__link">
    Concatenate Text
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#partial-fit" class="md-nav__link">
    Partial Fit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concatenate-features" class="md-nav__link">
    Concatenate Features
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/koaning/tokenwiser/edit/master/docs/guide/sklearn.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Scikit-Learn</h1>
                
                <p>Scikit-Learn pipelines are amazing but they are not perfect for simple text use-cases. </p>
<ul>
<li>The standard pipeline does not allow for interactive learning. You can 
apply <code class="highlight"><span class="na">.fit</span></code> but that's it. Even if the tools inside of the pipeline have 
a <code class="highlight"><span class="na">.partial_fit</span></code> available, the pipeline doesn't allow it. </li>
<li>The <code class="highlight">CountVectorizer</code> is great, but we might need some more text-tricks 
at our disposal that are specialized towards text to make this object more effective.  </li>
</ul>
<p>Part of what this library does is give more tools that extend scikit-learn for simple
text classification problems. In this document we will showcase some of the main features.</p>
<h2 id="text-preparation-tools">Text Preparation Tools<a class="headerlink" href="#text-preparation-tools" title="Permanent link">&para;</a></h2>
<p>Let's first discuss a basic pipeline for text inside of scikit-learn. </p>
<h3 id="base-pipeline">Base Pipeline<a class="headerlink" href="#base-pipeline" title="Permanent link">&para;</a></h3>
<p>This simplest text classification pipeline in scikit-learn looks like this; </p>
<p><img alt="" src="../images/minipipe.png" /></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span> 
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">SGDClassifier</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">CountVectorizer</span><span class="p">(),</span> 
    <span class="n">SGDClassifier</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>
<p>This pipeline will encode words as sparse features before passing them on to the logistic regression model. 
This pattern is very common and has proven to work well enough for many English text classification tasks.</p>
<p><img alt="" src="../images/how-it-works.png" /></p>
<p>The nice thing about using a <code class="highlight">SGDClassifier</code> is that we're able to learn from our data even if the dataset
does not fit in memory. We can call <code class="highlight"><span class="na">.partial_fit</span></code> instead of <code class="highlight"><span class="na">.fit</span></code> and learn in a more "online" setting. </p>
<p>That said, there are things we can do even to this pipeline to make it better.</p>
<h3 id="spelling-errors">Spelling Errors<a class="headerlink" href="#spelling-errors" title="Permanent link">&para;</a></h3>
<p>When you are classifying online texts you are often confronted with spelling errors. To 
deal with this you'd typically use a <a href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html">CountVectorizer</a> 
with a character-level analyzer such that you also encode subwords. </p>
<p><img alt="" src="../images/huge_sparse_array.png" /></p>
<p>With all of these subwords around, we'll be more robust against spelling errors.<br />
The downside of this approach is that you might wonder if we really <em>need</em> all these subwords. So how about this, 
let's add a step that will turn our text into subwords by splitting up hyphens. </p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">tokenwiser.textprep</span> <span class="kn">import</span> <span class="n">HyphenTextPrep</span>

<span class="n">multi</span> <span class="o">=</span> <span class="n">HyphenTextPrep</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">([</span><span class="s2">&quot;geology&quot;</span><span class="p">,</span> <span class="s2">&quot;astrology&quot;</span><span class="p">])</span>

<span class="k">assert</span> <span class="n">multi</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;geo logy&#39;</span><span class="p">,</span> <span class="s1">&#39;as tro logy&#39;</span><span class="p">]</span>
</code></pre></div>
<p>The <code class="highlight">HyphenTextPrep</code> preprocessor is a <code class="highlight">TextPrep</code>-object. For all intents and purposes these are 
scikit-learn compatible preprocessing components but they all output strings instead of arrays. What's
nice about these though is that you can "retokenize" the original text. This allows you to use the 
subtokens as if they were tokens which might help keep your pipelines lightweight while still keeping
them robust against certain spelling errors. </p>
<h3 id="long-texts">Long Texts<a class="headerlink" href="#long-texts" title="Permanent link">&para;</a></h3>
<p>There are some other tricks that you might want to apply for longer texts. Maybe you want to summarise a text before
vectorizing it. So maybe it'd be nice to use a transformer that keeps only the most important tokens. </p>
<p>A neat heuristic toolkit for this is <a href="https://github.com/LIAAD/yake">yake</a> (you can find a demo 
<a href="http://yake.inesctec.pt/demo/sample/sample1">here</a>). This package also features a scikit-learn compatible component for it.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">tokenwiser.textprep</span> <span class="kn">import</span> <span class="n">YakeTextPrep</span>

<span class="n">text</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">&quot;Sources tell us that Google is acquiring Kaggle, </span><span class="se">\</span>
<span class="s2">   a platform that hosts data science and machine learning&quot;</span>
<span class="p">]</span>
<span class="n">example</span> <span class="o">=</span> <span class="n">YakeTextPrep</span><span class="p">(</span><span class="n">top_n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hosts data science acquiring kaggle google is acquiring&#39;</span>
</code></pre></div>
<p>The idea here is to reduce the text down to only the most important words. Again, this trick 
might keep the algorithm lightweight and this trick will go a lot further than most "stopword"-lists.  </p>
<h3 id="bag-of-tricks">Bag of Tricks!<a class="headerlink" href="#bag-of-tricks" title="Permanent link">&para;</a></h3>
<p>The goal of this library is to host a few meaningful tricks that might be helpful. Here's some more; </p>
<ul>
<li><code class="highlight">Cleaner</code> lowercase text remove all non alphanumeric characters.</li>
<li><code class="highlight">Identity</code> just keeps the text as is, useful when constructing elaborate pipelines.</li>
<li><code class="highlight">PhoneticTextPrep</code> translate text into a phonetic encoding. </li>
<li><code class="highlight">SpacyPosTextPrep</code> add part of speech infomation to the text using spaCy.</li>
<li><code class="highlight">SpacyLemmaTextPrep</code> lemmatize the text using spaCy.</li>
</ul>
<p>All of these tools are part of the <code class="highlight">textprep</code> submodule and are documented in detail 
<a href="https://koaning.github.io/tokenwiser/api/textprep.html">here</a>.</p>
<h2 id="pipeline-tools">Pipeline Tools<a class="headerlink" href="#pipeline-tools" title="Permanent link">&para;</a></h2>
<p>Pipeline components are certainly nice. But maybe we can go a step further for text. Maybe
we can make better pipelines for text too!</p>
<h3 id="concatenate-text">Concatenate Text<a class="headerlink" href="#concatenate-text" title="Permanent link">&para;</a></h3>
<p>In scikit-learn you would use <code class="highlight">FeatureUnion</code> or <code class="highlight">make_union</code> to concatenate features in 
a pipeline. Ut is assumed that transformers output arrays that need to be concatenated so the
result of a concatenation is always a 2D array. This can be a bit awkward if you're using text preprocessors. </p>
<p><img alt="" src="../images/make_concat.png" /></p>
<p>The reason why we want to keep everything a string is so that the <code class="highlight">CountVectorizer</code> from scikit-learn
can properly encode it. That is why this library comes with a special union
component: <code class="highlight">TextConcat</code>. It concatenates the output of text-prep tools into a string instead of 
an array. Note that we also pack a convenient <code class="highlight">make_concat</code> function too.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span> 

<span class="kn">from</span> <span class="nn">tokenwiser.pipeline</span> <span class="kn">import</span> <span class="n">make_concat</span>
<span class="kn">from</span> <span class="nn">tokenwiser.textprep</span> <span class="kn">import</span> <span class="n">Cleaner</span><span class="p">,</span> <span class="n">Identity</span><span class="p">,</span> <span class="n">HyphenTextPrep</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">Cleaner</span><span class="p">(),</span>
    <span class="n">make_concat</span><span class="p">(</span><span class="n">Identity</span><span class="p">(),</span> <span class="n">HyphenTextPrep</span><span class="p">()),</span>
<span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">([</span><span class="s2">&quot;hello astrology!!!!&quot;</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">output</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;hello astrology hel lo astro logy&#39;</span><span class="p">]</span>
</code></pre></div>
<p>Again, we see that we're taking a text input and that we're generating a text output. The <code class="highlight">make_concat</code>
is making sure that we concatenate strings, not arrays! This is great when we want to follow up with 
a `CountVectorizer!</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span> 
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>

<span class="kn">from</span> <span class="nn">tokenwiser.pipeline</span> <span class="kn">import</span> <span class="n">make_concat</span>
<span class="kn">from</span> <span class="nn">tokenwiser.textprep</span> <span class="kn">import</span> <span class="n">Cleaner</span><span class="p">,</span> <span class="n">Identity</span><span class="p">,</span> <span class="n">HyphenTextPrep</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">Cleaner</span><span class="p">(),</span>
    <span class="n">make_concat</span><span class="p">(</span><span class="n">Identity</span><span class="p">(),</span> <span class="n">HyphenTextPrep</span><span class="p">()),</span>
    <span class="n">CountVectorizer</span><span class="p">(),</span> 
    <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>
<p>The mental picture for <code class="highlight">pipe</code>-pipeline looks like the diagram below. </p>
<p><img alt="" src="../images/pipeline.png" /> </p>
<h3 id="partial-fit">Partial Fit<a class="headerlink" href="#partial-fit" title="Permanent link">&para;</a></h3>
<p>We can go a step further though. The scikit-learn pipeline follows the <code class="highlight">fit/predict</code> API. That
means that we cannot use <code class="highlight"><span class="na">.partial_fit</span><span class="p">()</span></code>. Even if all the components in the pipeline are compatible 
with the <code class="highlight">partial_fit/predict</code> API. That is why this library also introduced components for mini-batch 
learning: <code class="highlight">PartialPipeline</code> and <code class="highlight">make_partial_pipeline</code> </p>
<p>In these scenarios you will need to swap out the <code class="highlight">CountVectorizer</code> with a <code class="highlight">HashVectorizer</code> in order to
be able to learn from new data comming in. </p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">SGDClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">HashingVectorizer</span>

<span class="kn">from</span> <span class="nn">tokenwiser.textprep</span> <span class="kn">import</span> <span class="n">Cleaner</span><span class="p">,</span> <span class="n">Identity</span><span class="p">,</span> <span class="n">HyphenTextPrep</span>
<span class="kn">from</span> <span class="nn">tokenwiser.pipeline</span> <span class="kn">import</span> <span class="n">make_concat</span><span class="p">,</span> <span class="n">make_partial_pipeline</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_partial_pipeline</span><span class="p">(</span>
    <span class="n">Cleaner</span><span class="p">(),</span>
    <span class="n">make_concat</span><span class="p">(</span><span class="n">Identity</span><span class="p">(),</span> <span class="n">HyphenTextPrep</span><span class="p">()),</span>
    <span class="n">HashingVectorizer</span><span class="p">(),</span> 
    <span class="n">SGDClassifier</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>
<p>This <code class="highlight">pipe</code>-Pipeline is scikit-learn compatible for all intents and purposes
but it has the option of learning from batches of data via <code class="highlight">partal_fit</code>. This is great
because it means that you're able to classify text even when it doesn't fit into memory!</p>
<blockquote>
<p>Note that all of the <code class="highlight">TextPrep</code>-components in this library allow for <code class="highlight">partial_fit</code>. </p>
</blockquote>
<p>To make a <code class="highlight">partial_fit</code> actually work you will need to supply the names of the <code class="highlight"><span class="n">classes</span></code> 
at learning time. Otherwise you might accidentally get a batch that only contains one class
and the algorithm would become numerically unstable. </p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">SGDClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">HashingVectorizer</span>
<span class="kn">from</span> <span class="nn">tokenwiser.textprep</span> <span class="kn">import</span> <span class="n">Cleaner</span><span class="p">,</span> <span class="n">Identity</span><span class="p">,</span> <span class="n">HyphenTextPrep</span>
<span class="kn">from</span> <span class="nn">tokenwiser.pipeline</span> <span class="kn">import</span> <span class="n">make_partial_pipeline</span><span class="p">,</span> <span class="n">make_partial_union</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_partial_pipeline</span><span class="p">(</span>
    <span class="n">Cleaner</span><span class="p">(),</span>
    <span class="n">make_partial_union</span><span class="p">(</span>
        <span class="n">make_partial_pipeline</span><span class="p">(</span><span class="n">Identity</span><span class="p">(),</span> <span class="n">HashingVectorizer</span><span class="p">()),</span>
        <span class="n">make_partial_pipeline</span><span class="p">(</span><span class="n">HyphenTextPrep</span><span class="p">(),</span> <span class="n">HashingVectorizer</span><span class="p">())</span>
    <span class="p">),</span>
    <span class="n">SGDClassifier</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;i really like this post&quot;</span><span class="p">,</span>
    <span class="s2">&quot;thanks for that comment&quot;</span><span class="p">,</span>
    <span class="s2">&quot;i enjoy this friendly forum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;this is a bad post&quot;</span><span class="p">,</span>
    <span class="s2">&quot;i dislike this article&quot;</span><span class="p">,</span>
    <span class="s2">&quot;this is not well written&quot;</span>
<span class="p">]</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="k">for</span> <span class="n">loop</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="c1"># It might make sense to loop over the same dataset multiple times</span>
    <span class="c1"># if the dataset is small. For larger datasets this isn&#39;t recommended. </span>
    <span class="n">pipe</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
</code></pre></div>
<h3 id="concatenate-features">Concatenate Features<a class="headerlink" href="#concatenate-features" title="Permanent link">&para;</a></h3>
<p>The standard <code class="highlight">FeatureUnion</code> from scikit-learn also does not allow for <code class="highlight"><span class="na">.partial_fit</span></code>. So we've
added a <code class="highlight">PartialFeatureUnion</code> class and a <code class="highlight">make_partial_union</code> function to this library as well.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">SGDClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">HashingVectorizer</span>
<span class="kn">from</span> <span class="nn">tokenwiser.textprep</span> <span class="kn">import</span> <span class="n">Cleaner</span><span class="p">,</span> <span class="n">Identity</span><span class="p">,</span> <span class="n">HyphenTextPrep</span>
<span class="kn">from</span> <span class="nn">tokenwiser.pipeline</span> <span class="kn">import</span> <span class="n">make_partial_pipeline</span><span class="p">,</span> <span class="n">make_partial_union</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_partial_pipeline</span><span class="p">(</span>
    <span class="n">Cleaner</span><span class="p">(),</span>
    <span class="n">make_partial_union</span><span class="p">(</span>
        <span class="n">make_partial_pipeline</span><span class="p">(</span><span class="n">Identity</span><span class="p">(),</span> <span class="n">HashingVectorizer</span><span class="p">()),</span>
        <span class="n">make_partial_pipeline</span><span class="p">(</span><span class="n">HyphenTextPrep</span><span class="p">(),</span> <span class="n">HashingVectorizer</span><span class="p">())</span>
    <span class="p">),</span>
    <span class="n">SGDClassifier</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;i really like this post&quot;</span><span class="p">,</span>
    <span class="s2">&quot;thanks for that comment&quot;</span><span class="p">,</span>
    <span class="s2">&quot;i enjoy this friendly forum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;this is a bad post&quot;</span><span class="p">,</span>
    <span class="s2">&quot;i dislike this article&quot;</span><span class="p">,</span>
    <span class="s2">&quot;this is not well written&quot;</span>
<span class="p">]</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="k">for</span> <span class="n">loop</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">pipe</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../index.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        
        <a href="spacy.html" class="md-footer__link md-footer__link--next" aria-label="Next: spaCy" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              spaCy
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Maintained by <a href="https://twitter.com/fishnets88">Vincent</a>.
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>